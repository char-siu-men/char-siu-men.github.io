{"version":3,"sources":["a5contact.js"],"names":["grecaptchaModel","corrected","init","grecaptcha","response","getResponse","length","correctCallback","onCorrectCaptcha","reCaptchaCorrectCallback","FormContainer","id","url","initFunc","title","this","$","start","location","hash","href","baseHref","useSignIn","firebaseUiConfig","callbacks","signInSuccess","user","credentialIgnored","redirectUrlIgnored","handleSignedInUser","signInSuccessUrl","signInFlow","signInOptions","provider","firebase","auth","GoogleAuthProvider","PROVIDER_ID","scopes","FacebookAuthProvider","TwitterAuthProvider","GithubAuthProvider","EmailAuthProvider","tosUrl","ui","firebaseui","AuthUI","$confirmButton","on","onClickConfirmNext","window","onPopState","initInput","initConfirm","$form","extend","validator","messages","required","email","validate","rules","type","name","kana","tel","content","agree","domain","mysite","errorPlacement","error","element","attr","insertAfter","closest","onsubmit","submitHandler","onInputSuccess","prop","input","val","company","document","referrer","test","text","html","safeNl2br","gaSendEvent","pushStateByContainer","activeContainer","animate","scrollTop","console","log","userKey","replace","m","moment","rightNow","format","db","database","contact","ref","set","e","eventIgnored","containerId","each","containers","i","container","getContainer","eventAction","ga","history","pushState","that","show","hide","str","$safeText","firebaseConfig","apiKey","authDomain","databaseURL","storageBucket","messagingSenderId","initializeApp"],"mappings":"AAAA,YASA,IAAIA,kBACFC,WAAW,EACXC,KAAM,WAEJ,GADAF,gBAAgBC,WAAY,EACF,mBAAfE,YAAX,CAGA,GAAIC,GAAWD,WAAWE,aAC1BL,iBAAgBC,UAAaG,EAASE,OAAS,IAEjDC,gBAAiB,WACfP,gBAAgBC,WAAY,EAC5BD,gBAAgBQ,oBAElBA,iBAAkB,cAGhBC,yBAA2B,WAC7BT,gBAAgBO,mBAEdG,cAAgB,SAASC,EAAIC,EAAKC,EAAUC,GAC9CC,KAAKJ,GAAKA,EACVI,KAAKH,IAAMA,EACXG,KAAKF,SAAWA,EAChBE,KAAKD,MAAQA,EAEfE,GAAE,WA6BA,QAASC,KACP,GAAIC,SAASC,KAAKb,OAAS,EAEzB,YADAY,SAASE,KAAOC,EAIlB,IAAIC,EAAW,CAEb,GAAIC,IACFC,WAEEC,cAAe,SAASC,EAAMC,EAAmBC,GAG/C,MAFAC,oBAAmBH,IAEZ,IAGXI,iBAAkBT,EAElBU,WAAY,QACZC,gBAEIC,SAAUC,SAASC,KAAKC,mBAAmBC,YAC3CC,QAAS,gDAGTL,SAAUC,SAASC,KAAKI,qBAAqBF,YAC7CC,QACE,iBACA,QAEA,iBAGJJ,SAASC,KAAKK,oBAAoBH,YAClCH,SAASC,KAAKM,mBAAmBJ,YACjCH,SAASC,KAAKO,kBAAkBL,aAGlCM,OAAQtB,GAGNuB,EAAK,GAAIC,YAAWV,KAAKW,OAAOZ,SAASC,OAE7CS,GAAG3B,MAAM,6BAA8BM,GAIzCwB,EAAeC,GAAG,QAASC,GAC3BjC,EAAEkC,QAAQF,GAAG,WAAYG,GACzBC,IACAC,IAMF,QAASD,KACP,GAAIE,GAAQtC,EAAE,wBAEdA,GAAEuC,OAAOvC,EAAEwC,UAAUC,UACnBC,SAAU,SACVC,MAAO,wBAETL,EAAMM,UACJC,OACEC,MAAOJ,UAAU,GACjBK,MAAOL,UAAU,GACjBM,MAAON,UAAU,GACjBO,KAAMP,UAAU,GAChBC,OAAQD,UAAU,EAAMC,OAAO,GAC/BO,SAAUR,UAAU,GACpBS,OAAQT,UAAU,GAClBU,QAASV,UAAU,EAAMW,QAAQ,IAEnCZ,UACEU,OACET,SAAU,cAGdY,eAAgB,SAASC,EAAOC,GACD,SAAzBA,EAAQC,KAAK,QACfF,EAAMG,YACJ1D,EAAEwD,GAASG,QAAQ,QAEa,UAAzBH,EAAQC,KAAK,QACtBF,EAAMG,YACJ1D,EAAEwD,GAASG,QAAQ,UAGrBJ,EAAMG,YAAYF,IAGtBI,UAAU,EACVC,cAAeC,IAOnB,QAASzB,KACPrD,gBAAgBE,OAChB6C,EAAegC,KAAK,YAAa/E,gBAAgBC,WAMnD,QAAS6E,KAYP,MAXAE,IACElB,KAAM9C,EAAE,8BAA8BiE,MACtCC,QAASlE,EAAE,YAAYV,OAAS,EAAIU,EAAE,YAAYiE,MAAQ,GAC1DlB,KAAM/C,EAAE,SAASiE,MACjBjB,KAAMhD,EAAE,SAASiE,MACjBhB,IAAKjD,EAAE,QAAQiE,MACftB,MAAO3C,EAAE,UAAUiE,MACnBf,QAASlD,EAAE,YAAYiE,MACvBb,OAAQe,SAASf,OACjBgB,SAAUD,SAASC,UAEf,aAAaC,KAAKF,SAASf,SAKjCpD,EAAE,iBAAiBsE,KAAKN,EAAMlB,MAC9B9C,EAAE,oBAAoBsE,KAAKN,EAAME,SACjClE,EAAE,iBAAiBsE,KAAKN,EAAMjB,MAC9B/C,EAAE,iBAAiBsE,KAAKN,EAAMhB,MAC9BhD,EAAE,gBAAgBsE,KAAKN,EAAMf,KAC7BjD,EAAE,kBAAkBsE,KAAKN,EAAMrB,OAC/B3C,EAAE,oBAAoBuE,KAAKC,EAAUR,EAAMd,UAE3CuB,EAAY,WACZC,EAAqB,sBACrBC,EAAgB,0BAEhB3E,GAAE,aAAa4E,SAASC,UAAW,GAAI,QAhBrCC,SAAQC,IAAI,4BAuBhB,QAAS9C,KACP,IAAKjD,gBAAgBC,UACnB,OAAO,CAGT,IAAI+F,GAAUhB,EAAMrB,MAAMsC,QAAQ,OAAQ,KACtCC,EAAIC,SACJC,EAAWF,EAAEG,OAAO,uBAEpBC,EAAKpE,SAASqE,WACdC,EAAUF,EAAGG,IAAI,YAAcT,EAAU,IAAMI,EAEnD,KACEI,EAAQE,IAAI1B,GACZ,MAAO2B,GAEP,KADAb,SAAQC,IAAIY,GACNA,EAQR,MALAlB,GAAY,UACZC,EAAqB,qBACrBC,EAAgB,qBAEhB3E,EAAE,aAAa4E,SAASC,UAAW,GAAI,IAChC,EAOT,QAAS1C,GAAWyD,GAMlB,GAAIzF,GAAOD,SAASC,KAChB0F,EAAc,EAClB7F,GAAE8F,KAAKC,EAAY,SAASC,EAAGC,GAC7B,GAAIA,EAAUrG,MAAQO,EAEpB,MADA0F,GAAcI,EAAUtG,IACjB,GAGX,IAAIsG,GAAYC,EAAaL,EAC7BlB,GAAgBsB,EAAUtG,IAQ5B,QAAS8E,GAAY0B,GACnB,GAAIrD,GAAO9C,EAAE,8BAA8BiE,KAC3CmC,IAAG,OAAQ,QAAS,UAAWD,EAAarD,GAS9C,QAAS4B,GAAqBmB,GAC5B,GAAII,GAAYC,EAAaL,EAC7BQ,SAAQC,WAAU,EAAML,EAAUnG,MAAOO,EAAW4F,EAAUrG,KAOhE,QAAS+E,GAAgBkB,GACH,KAAhBA,IACFA,EAAc,mBAEhB,IAAIU,GAAOL,EAAaL,EACxB7F,GAAE8F,KAAKC,EAAY,SAASC,EAAGC,GACzBA,EAAUtG,KAAO4G,EAAK5G,GACxBK,EAAEiG,EAAUtG,IAAI6G,OAEhBxG,EAAEiG,EAAUtG,IAAI8G,SAGE,OAAlBF,EAAK1G,UACP0G,EAAK1G,WAST,QAASqG,GAAaL,GACpB,GAAIU,GAAO,IAUX,OATAvG,GAAE8F,KAAKC,EAAY,SAASC,EAAGC,GAC7B,GAAIA,EAAUtG,KAAOkG,EAEnB,MADAU,GAAON,GACA,IAGE,OAATM,IACFA,EAAOR,EAAW,IAEbQ,EAQT,QAAS/B,GAAUkC,GACjB,GAAIC,GAAY3G,EAAE,UAClB2G,GAAUrC,KAAKoC,EACf,IAAInC,GAAOoC,EAAUpC,MACrB,OAAOA,GAAKU,QAAQ,QAAS,UAAUA,QAAQ,UAAW,UAlS5D,GAAI3E,IAAY,EACZD,EAAWH,SAASE,KAAK6E,QAAQ,MAAO,IAExClD,EAAiB/B,EAAE,kCACnB+F,GACF,GAAIrG,eACF,mBAAoB,SAAU0C,EAAW,UAC3C,GAAI1C,eACF,qBAAsB,WAAY2C,EAAa,cACjD,GAAI3C,eACF,oBAAqB,UAAW,KAAM,gBAEtCsE,KAEA4C,GACFC,OAAQ,0CACRC,WAAY,2CACZC,YAAa,kDACbC,cAAe,uCACfC,kBAAmB,eAErB/F,UAASgG,cAAcN,GAmRvB5H,gBAAgBQ,iBAAmB,WACjCuC,EAAegC,KAAK,YAAa/E,gBAAgBC,YAGnDgB","file":"a5contact.js","sourcesContent":["'use strict';\n/* global\n    $, location, firebase,\n    grecaptcha\n*/\n\n/**\n * grecaptchaのラッパークラス\n */\nvar grecaptchaModel = {\n  corrected: false,\n  init: function() {\n    grecaptchaModel.corrected = false;\n    if (typeof grecaptcha === 'undefined') {\n      return;\n    }\n    var response = grecaptcha.getResponse();\n    grecaptchaModel.corrected = (response.length > 0);\n  },\n  correctCallback: function() {\n    grecaptchaModel.corrected = true;\n    grecaptchaModel.onCorrectCaptcha();\n  },\n  onCorrectCaptcha: function() {\n  }\n};\nvar reCaptchaCorrectCallback = function() {\n  grecaptchaModel.correctCallback();\n};\nvar FormContainer = function(id, url, initFunc, title) {\n  this.id = id;\n  this.url = url;\n  this.initFunc = initFunc;\n  this.title = title;\n};\n$(function() {\n  'use strict';\n\n  var useSignIn = false;\n  var baseHref = location.href.replace(/#.*/, '');\n  // 確認画面の送信ボタン\n  var $confirmButton = $('.confirm_container form button');\n  var containers = [\n    new FormContainer(\n      '.input_container', '#input', initInput, 'お問い合わせ'),\n    new FormContainer(\n      '.confirm_container', '#confirm', initConfirm, 'お問い合わせ内容確認'),\n    new FormContainer(\n      '.thanks_container', '#thanks', null, 'お問い合わせ承りました')\n  ];\n  var input = {};\n\n  var firebaseConfig = {\n    apiKey: 'AIzaSyDSf5IQpGTOY4ploswbC_hiRu3Ui5Oy0Z4',\n    authDomain: 'altus-five-contact-fa5bc.firebaseapp.com',\n    databaseURL: 'https://altus-five-contact-fa5bc.firebaseio.com',\n    storageBucket: 'altus-five-contact-fa5bc.appspot.com',\n    messagingSenderId: '923242406897'\n  };\n  firebase.initializeApp(firebaseConfig);\n\n  /**\n   * 画面の初期化処理\n   */\n  function start() {\n    if (location.hash.length > 0) {\n      location.href = baseHref;\n      return;\n    }\n\n    if (useSignIn) {\n      // FirebaseUI config.\n      var firebaseUiConfig = {\n        callbacks: {\n          // Called when the user has been successfully signed in.\n          signInSuccess: function(user, credentialIgnored, redirectUrlIgnored) {\n            handleSignedInUser(user);\n            // Do not redirect.\n            return false;\n          }\n        },\n        signInSuccessUrl: baseHref,\n        // Opens IDP Providers sign-in flow in a popup.\n        signInFlow: 'popup',\n        signInOptions: [\n          {\n            provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n            scopes: ['https://www.googleapis.com/auth/plus.login']\n          },\n          {\n            provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID,\n            scopes: [\n              'public_profile',\n              'email',\n              // 'user_likes',\n              'user_friends'\n            ]\n          },\n          firebase.auth.TwitterAuthProvider.PROVIDER_ID,\n          firebase.auth.GithubAuthProvider.PROVIDER_ID,\n          firebase.auth.EmailAuthProvider.PROVIDER_ID\n        ],\n        // Terms of service url.\n        tosUrl: baseHref\n      };\n      // Initialize the FirebaseUI Widget using Firebase.\n      var ui = new firebaseui.auth.AuthUI(firebase.auth());\n      // The start method will wait until the DOM is loaded.\n      ui.start('#firebaseui-auth-container', firebaseUiConfig);\n      // </FirebaseUI>\n    }\n\n    $confirmButton.on('click', onClickConfirmNext);\n    $(window).on('popstate', onPopState);\n    initInput();\n    initConfirm();\n  }\n\n  /**\n   * 入力画面の初期化\n   */\n  function initInput() {\n    var $form = $('.input_container form');\n    // バリデーションの設定\n    $.extend($.validator.messages, {\n      required: '必須項目です',\n      email: '正しいメールアドレスを入力してください'\n    });\n    $form.validate({\n      rules: {\n        type: {required: true},\n        name: {required: true},\n        kana: {required: true},\n        tel: {required: true},\n        email: {required: true, email: true},\n        content: {required: true},\n        agree: {required: true},\n        domain: {required: true, mysite: true}\n      },\n      messages: {\n        agree: {\n          required: 'ご同意お願いします'\n        }\n      },\n      errorPlacement: function(error, element) {\n        if (element.attr('name') === 'type') {\n          error.insertAfter(\n            $(element).closest('div')\n          );\n        } else if (element.attr('name') === 'agree') {\n          error.insertAfter(\n            $(element).closest('label')\n          );\n        } else {\n          error.insertAfter(element);\n        }\n      },\n      onsubmit: true,\n      submitHandler: onInputSuccess\n    });\n  }\n\n  /**\n   * 確認画面の初期化\n   */\n  function initConfirm() {\n    grecaptchaModel.init();\n    $confirmButton.prop('disabled', !grecaptchaModel.corrected);\n  }\n\n  /**\n   * 入力画面で、「次へ」ボタンクリック時のイベント\n   */\n  function onInputSuccess() {\n    input = {\n      type: $('input[name=\"type\"]:checked').val(),\n      company: $('#company').length > 0 ? $('#company').val() : '',\n      name: $('#name').val(),\n      kana: $('#kana').val(),\n      tel: $('#tel').val(),\n      email: $('#email').val(),\n      content: $('#content').val(),\n      domain: document.domain,\n      referrer: document.referrer\n    };\n    if (!(/\\.altus5\\./.test(document.domain))) {\n      console.log('altus5以外のドメインでは使わないでください');\n      return;\n    }\n\n    $('#confirm_type').text(input.type);\n    $('#confirm_company').text(input.company);\n    $('#confirm_name').text(input.name);\n    $('#confirm_kana').text(input.kana);\n    $('#confirm_tel').text(input.tel);\n    $('#confirm_email').text(input.email);\n    $('#confirm_content').html(safeNl2br(input.content));\n\n    gaSendEvent('confirm');\n    pushStateByContainer('.confirm_container');\n    activeContainer('.confirm_container');\n\n    $('body,html').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * 確認画面で、「次へ」ボタンクリック時のイベント\n   * @return {boolean} 常にfalse\n   */\n  function onClickConfirmNext() {\n    if (!grecaptchaModel.corrected) {\n      return false;\n    }\n\n    var userKey = input.email.replace(/[.]/g, '_');\n    var m = moment();\n    var rightNow = m.format('YYYY-MM-DD-HH-mm-ss');\n\n    var db = firebase.database();\n    var contact = db.ref('/contact/' + userKey + '/' + rightNow);\n\n    try {\n      contact.set(input);\n    } catch (e) {\n      console.log(e);\n      throw e;\n    }\n\n    gaSendEvent('thanks');\n    pushStateByContainer('.thanks_container');\n    activeContainer('.thanks_container');\n\n    $('body,html').animate({scrollTop: 0}, 0);\n    return false;\n  }\n\n  /**\n   * URLが変わったときのイベント\n   * @param {Event} eventIgnored イベント\n   */\n  function onPopState(eventIgnored) {\n    /*\n    if (!event.originalEvent.state) {\n      return;\n    }\n    */\n    var hash = location.hash;\n    var containerId = '';\n    $.each(containers, function(i, container) {\n      if (container.url === hash) {\n        containerId = container.id;\n        return false;\n      }\n    });\n    var container = getContainer(containerId);\n    activeContainer(container.id);\n  }\n\n  /**\n   * GAにイベント記録。\n   * お問い合わせの依頼タイプとともに送信する。\n   * @param {Event} eventAction イベント\n   */\n  function gaSendEvent(eventAction) {\n    var type = $('input[name=\"type\"]:checked').val();\n    ga('send', 'event', 'Contact', eventAction, type);\n  }\n\n  /**\n   * containerId で pushState するユーティリティ.\n   * containers 配列を containerId で検索して、\n   * container の URL で pushState する\n   * @param {string} containerId コンテナID\n   */\n  function pushStateByContainer(containerId) {\n    var container = getContainer(containerId);\n    history.pushState(true, container.title, baseHref + container.url);\n  }\n\n  /**\n   * containerId で show/hide するユーティリティ.\n   * @param {string} containerId コンテナID\n   */\n  function activeContainer(containerId) {\n    if (containerId === '') {\n      containerId = '.input_container';\n    }\n    var that = getContainer(containerId);\n    $.each(containers, function(i, container) {\n      if (container.id === that.id) {\n        $(container.id).show();\n      } else {\n        $(container.id).hide();\n      }\n    });\n    if (that.initFunc !== null) {\n      that.initFunc();\n    }\n  }\n\n  /**\n   * containerId で containers を探す\n   * @param {string} containerId コンテナID\n   * @return {FormContainer} コンテナ\n   */\n  function getContainer(containerId) {\n    var that = null;\n    $.each(containers, function(i, container) {\n      if (container.id === containerId) {\n        that = container;\n        return false;\n      }\n    });\n    if (that === null) {\n      that = containers[0];\n    }\n    return that;\n  }\n\n  /**\n   * 改行を<br>に変換して表示する\n   * @param {string} str 変換前\n   * @return {string} 変換後\n   */\n  function safeNl2br(str) {\n    var $safeText = $('<p></p>');\n    $safeText.text(str);\n    var html = $safeText.html();\n    return html.replace(/\\r\\n/g, '<br />').replace(/[\\r\\n]/g, '<br />');\n  }\n\n  /**\n   * キャプチャがOKになったときのイベントを上書き設定する\n   */\n  grecaptchaModel.onCorrectCaptcha = function() {\n    $confirmButton.prop('disabled', !grecaptchaModel.corrected);\n  };\n\n  start();\n});\n\n//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhNWNvbnRhY3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuLyogZ2xvYmFsXG4gICAgJCwgbG9jYXRpb24sIGZpcmViYXNlLFxuICAgIGdyZWNhcHRjaGFcbiovXG5cbi8qKlxuICogZ3JlY2FwdGNoYeOBruODqeODg+ODkeODvOOCr+ODqeOCuVxuICovXG52YXIgZ3JlY2FwdGNoYU1vZGVsID0ge1xuICBjb3JyZWN0ZWQ6IGZhbHNlLFxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICBncmVjYXB0Y2hhTW9kZWwuY29ycmVjdGVkID0gZmFsc2U7XG4gICAgaWYgKHR5cGVvZiBncmVjYXB0Y2hhID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcmVzcG9uc2UgPSBncmVjYXB0Y2hhLmdldFJlc3BvbnNlKCk7XG4gICAgZ3JlY2FwdGNoYU1vZGVsLmNvcnJlY3RlZCA9IChyZXNwb25zZS5sZW5ndGggPiAwKTtcbiAgfSxcbiAgY29ycmVjdENhbGxiYWNrOiBmdW5jdGlvbigpIHtcbiAgICBncmVjYXB0Y2hhTW9kZWwuY29ycmVjdGVkID0gdHJ1ZTtcbiAgICBncmVjYXB0Y2hhTW9kZWwub25Db3JyZWN0Q2FwdGNoYSgpO1xuICB9LFxuICBvbkNvcnJlY3RDYXB0Y2hhOiBmdW5jdGlvbigpIHtcbiAgfVxufTtcbnZhciByZUNhcHRjaGFDb3JyZWN0Q2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcbiAgZ3JlY2FwdGNoYU1vZGVsLmNvcnJlY3RDYWxsYmFjaygpO1xufTtcbnZhciBGb3JtQ29udGFpbmVyID0gZnVuY3Rpb24oaWQsIHVybCwgaW5pdEZ1bmMsIHRpdGxlKSB7XG4gIHRoaXMuaWQgPSBpZDtcbiAgdGhpcy51cmwgPSB1cmw7XG4gIHRoaXMuaW5pdEZ1bmMgPSBpbml0RnVuYztcbiAgdGhpcy50aXRsZSA9IHRpdGxlO1xufTtcbiQoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgdXNlU2lnbkluID0gZmFsc2U7XG4gIHZhciBiYXNlSHJlZiA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvIy4qLywgJycpO1xuICAvLyDnorroqo3nlLvpnaLjga7pgIHkv6Hjg5zjgr/jg7NcbiAgdmFyICRjb25maXJtQnV0dG9uID0gJCgnLmNvbmZpcm1fY29udGFpbmVyIGZvcm0gYnV0dG9uJyk7XG4gIHZhciBjb250YWluZXJzID0gW1xuICAgIG5ldyBGb3JtQ29udGFpbmVyKFxuICAgICAgJy5pbnB1dF9jb250YWluZXInLCAnI2lucHV0JywgaW5pdElucHV0LCAn44GK5ZWP44GE5ZCI44KP44GbJyksXG4gICAgbmV3IEZvcm1Db250YWluZXIoXG4gICAgICAnLmNvbmZpcm1fY29udGFpbmVyJywgJyNjb25maXJtJywgaW5pdENvbmZpcm0sICfjgYrllY/jgYTlkIjjgo/jgZvlhoXlrrnnorroqo0nKSxcbiAgICBuZXcgRm9ybUNvbnRhaW5lcihcbiAgICAgICcudGhhbmtzX2NvbnRhaW5lcicsICcjdGhhbmtzJywgbnVsbCwgJ+OBiuWVj+OBhOWQiOOCj+OBm+aJv+OCiuOBvuOBl+OBnycpXG4gIF07XG4gIHZhciBpbnB1dCA9IHt9O1xuXG4gIHZhciBmaXJlYmFzZUNvbmZpZyA9IHtcbiAgICBhcGlLZXk6ICdBSXphU3lEU2Y1SVFwR1RPWTRwbG9zd2JDX2hpUnUzVWk1T3kwWjQnLFxuICAgIGF1dGhEb21haW46ICdhbHR1cy1maXZlLWNvbnRhY3QtZmE1YmMuZmlyZWJhc2VhcHAuY29tJyxcbiAgICBkYXRhYmFzZVVSTDogJ2h0dHBzOi8vYWx0dXMtZml2ZS1jb250YWN0LWZhNWJjLmZpcmViYXNlaW8uY29tJyxcbiAgICBzdG9yYWdlQnVja2V0OiAnYWx0dXMtZml2ZS1jb250YWN0LWZhNWJjLmFwcHNwb3QuY29tJyxcbiAgICBtZXNzYWdpbmdTZW5kZXJJZDogJzkyMzI0MjQwNjg5NydcbiAgfTtcbiAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7XG5cbiAgLyoqXG4gICAqIOeUu+mdouOBruWIneacn+WMluWHpueQhlxuICAgKi9cbiAgZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgaWYgKGxvY2F0aW9uLmhhc2gubGVuZ3RoID4gMCkge1xuICAgICAgbG9jYXRpb24uaHJlZiA9IGJhc2VIcmVmO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh1c2VTaWduSW4pIHtcbiAgICAgIC8vIEZpcmViYXNlVUkgY29uZmlnLlxuICAgICAgdmFyIGZpcmViYXNlVWlDb25maWcgPSB7XG4gICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgIC8vIENhbGxlZCB3aGVuIHRoZSB1c2VyIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBzaWduZWQgaW4uXG4gICAgICAgICAgc2lnbkluU3VjY2VzczogZnVuY3Rpb24odXNlciwgY3JlZGVudGlhbElnbm9yZWQsIHJlZGlyZWN0VXJsSWdub3JlZCkge1xuICAgICAgICAgICAgaGFuZGxlU2lnbmVkSW5Vc2VyKHVzZXIpO1xuICAgICAgICAgICAgLy8gRG8gbm90IHJlZGlyZWN0LlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2lnbkluU3VjY2Vzc1VybDogYmFzZUhyZWYsXG4gICAgICAgIC8vIE9wZW5zIElEUCBQcm92aWRlcnMgc2lnbi1pbiBmbG93IGluIGEgcG9wdXAuXG4gICAgICAgIHNpZ25JbkZsb3c6ICdwb3B1cCcsXG4gICAgICAgIHNpZ25Jbk9wdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlcjogZmlyZWJhc2UuYXV0aC5Hb29nbGVBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQsXG4gICAgICAgICAgICBzY29wZXM6IFsnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9wbHVzLmxvZ2luJ11cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGVyOiBmaXJlYmFzZS5hdXRoLkZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELFxuICAgICAgICAgICAgc2NvcGVzOiBbXG4gICAgICAgICAgICAgICdwdWJsaWNfcHJvZmlsZScsXG4gICAgICAgICAgICAgICdlbWFpbCcsXG4gICAgICAgICAgICAgIC8vICd1c2VyX2xpa2VzJyxcbiAgICAgICAgICAgICAgJ3VzZXJfZnJpZW5kcydcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZpcmViYXNlLmF1dGguVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcbiAgICAgICAgICBmaXJlYmFzZS5hdXRoLkdpdGh1YkF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcbiAgICAgICAgICBmaXJlYmFzZS5hdXRoLkVtYWlsQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEXG4gICAgICAgIF0sXG4gICAgICAgIC8vIFRlcm1zIG9mIHNlcnZpY2UgdXJsLlxuICAgICAgICB0b3NVcmw6IGJhc2VIcmVmXG4gICAgICB9O1xuICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgRmlyZWJhc2VVSSBXaWRnZXQgdXNpbmcgRmlyZWJhc2UuXG4gICAgICB2YXIgdWkgPSBuZXcgZmlyZWJhc2V1aS5hdXRoLkF1dGhVSShmaXJlYmFzZS5hdXRoKCkpO1xuICAgICAgLy8gVGhlIHN0YXJ0IG1ldGhvZCB3aWxsIHdhaXQgdW50aWwgdGhlIERPTSBpcyBsb2FkZWQuXG4gICAgICB1aS5zdGFydCgnI2ZpcmViYXNldWktYXV0aC1jb250YWluZXInLCBmaXJlYmFzZVVpQ29uZmlnKTtcbiAgICAgIC8vIDwvRmlyZWJhc2VVST5cbiAgICB9XG5cbiAgICAkY29uZmlybUJ1dHRvbi5vbignY2xpY2snLCBvbkNsaWNrQ29uZmlybU5leHQpO1xuICAgICQod2luZG93KS5vbigncG9wc3RhdGUnLCBvblBvcFN0YXRlKTtcbiAgICBpbml0SW5wdXQoKTtcbiAgICBpbml0Q29uZmlybSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWFpeWKm+eUu+mdouOBruWIneacn+WMllxuICAgKi9cbiAgZnVuY3Rpb24gaW5pdElucHV0KCkge1xuICAgIHZhciAkZm9ybSA9ICQoJy5pbnB1dF9jb250YWluZXIgZm9ybScpO1xuICAgIC8vIOODkOODquODh+ODvOOCt+ODp+ODs+OBruioreWumlxuICAgICQuZXh0ZW5kKCQudmFsaWRhdG9yLm1lc3NhZ2VzLCB7XG4gICAgICByZXF1aXJlZDogJ+W/hemgiOmgheebruOBp+OBmScsXG4gICAgICBlbWFpbDogJ+ato+OBl+OBhOODoeODvOODq+OCouODieODrOOCueOCkuWFpeWKm+OBl+OBpuOBj+OBoOOBleOBhCdcbiAgICB9KTtcbiAgICAkZm9ybS52YWxpZGF0ZSh7XG4gICAgICBydWxlczoge1xuICAgICAgICB0eXBlOiB7cmVxdWlyZWQ6IHRydWV9LFxuICAgICAgICBuYW1lOiB7cmVxdWlyZWQ6IHRydWV9LFxuICAgICAgICBrYW5hOiB7cmVxdWlyZWQ6IHRydWV9LFxuICAgICAgICB0ZWw6IHtyZXF1aXJlZDogdHJ1ZX0sXG4gICAgICAgIGVtYWlsOiB7cmVxdWlyZWQ6IHRydWUsIGVtYWlsOiB0cnVlfSxcbiAgICAgICAgY29udGVudDoge3JlcXVpcmVkOiB0cnVlfSxcbiAgICAgICAgYWdyZWU6IHtyZXF1aXJlZDogdHJ1ZX0sXG4gICAgICAgIGRvbWFpbjoge3JlcXVpcmVkOiB0cnVlLCBteXNpdGU6IHRydWV9XG4gICAgICB9LFxuICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgYWdyZWU6IHtcbiAgICAgICAgICByZXF1aXJlZDogJ+OBlOWQjOaEj+OBiumhmOOBhOOBl+OBvuOBmSdcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9yUGxhY2VtZW50OiBmdW5jdGlvbihlcnJvciwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudC5hdHRyKCduYW1lJykgPT09ICd0eXBlJykge1xuICAgICAgICAgIGVycm9yLmluc2VydEFmdGVyKFxuICAgICAgICAgICAgJChlbGVtZW50KS5jbG9zZXN0KCdkaXYnKVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5hdHRyKCduYW1lJykgPT09ICdhZ3JlZScpIHtcbiAgICAgICAgICBlcnJvci5pbnNlcnRBZnRlcihcbiAgICAgICAgICAgICQoZWxlbWVudCkuY2xvc2VzdCgnbGFiZWwnKVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3IuaW5zZXJ0QWZ0ZXIoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgIHN1Ym1pdEhhbmRsZXI6IG9uSW5wdXRTdWNjZXNzXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICog56K66KqN55S76Z2i44Gu5Yid5pyf5YyWXG4gICAqL1xuICBmdW5jdGlvbiBpbml0Q29uZmlybSgpIHtcbiAgICBncmVjYXB0Y2hhTW9kZWwuaW5pdCgpO1xuICAgICRjb25maXJtQnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgIWdyZWNhcHRjaGFNb2RlbC5jb3JyZWN0ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWFpeWKm+eUu+mdouOBp+OAgeOAjOasoeOBuOOAjeODnOOCv+ODs+OCr+ODquODg+OCr+aZguOBruOCpOODmeODs+ODiFxuICAgKi9cbiAgZnVuY3Rpb24gb25JbnB1dFN1Y2Nlc3MoKSB7XG4gICAgaW5wdXQgPSB7XG4gICAgICB0eXBlOiAkKCdpbnB1dFtuYW1lPVwidHlwZVwiXTpjaGVja2VkJykudmFsKCksXG4gICAgICBjb21wYW55OiAkKCcjY29tcGFueScpLmxlbmd0aCA+IDAgPyAkKCcjY29tcGFueScpLnZhbCgpIDogJycsXG4gICAgICBuYW1lOiAkKCcjbmFtZScpLnZhbCgpLFxuICAgICAga2FuYTogJCgnI2thbmEnKS52YWwoKSxcbiAgICAgIHRlbDogJCgnI3RlbCcpLnZhbCgpLFxuICAgICAgZW1haWw6ICQoJyNlbWFpbCcpLnZhbCgpLFxuICAgICAgY29udGVudDogJCgnI2NvbnRlbnQnKS52YWwoKSxcbiAgICAgIGRvbWFpbjogZG9jdW1lbnQuZG9tYWluLFxuICAgICAgcmVmZXJyZXI6IGRvY3VtZW50LnJlZmVycmVyXG4gICAgfTtcbiAgICBpZiAoISgvXFwuYWx0dXM1XFwuLy50ZXN0KGRvY3VtZW50LmRvbWFpbikpKSB7XG4gICAgICBjb25zb2xlLmxvZygnYWx0dXM15Lul5aSW44Gu44OJ44Oh44Kk44Oz44Gn44Gv5L2/44KP44Gq44GE44Gn44GP44Gg44GV44GEJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgJCgnI2NvbmZpcm1fdHlwZScpLnRleHQoaW5wdXQudHlwZSk7XG4gICAgJCgnI2NvbmZpcm1fY29tcGFueScpLnRleHQoaW5wdXQuY29tcGFueSk7XG4gICAgJCgnI2NvbmZpcm1fbmFtZScpLnRleHQoaW5wdXQubmFtZSk7XG4gICAgJCgnI2NvbmZpcm1fa2FuYScpLnRleHQoaW5wdXQua2FuYSk7XG4gICAgJCgnI2NvbmZpcm1fdGVsJykudGV4dChpbnB1dC50ZWwpO1xuICAgICQoJyNjb25maXJtX2VtYWlsJykudGV4dChpbnB1dC5lbWFpbCk7XG4gICAgJCgnI2NvbmZpcm1fY29udGVudCcpLmh0bWwoc2FmZU5sMmJyKGlucHV0LmNvbnRlbnQpKTtcblxuICAgIGdhU2VuZEV2ZW50KCdjb25maXJtJyk7XG4gICAgcHVzaFN0YXRlQnlDb250YWluZXIoJy5jb25maXJtX2NvbnRhaW5lcicpO1xuICAgIGFjdGl2ZUNvbnRhaW5lcignLmNvbmZpcm1fY29udGFpbmVyJyk7XG5cbiAgICAkKCdib2R5LGh0bWwnKS5hbmltYXRlKHtzY3JvbGxUb3A6IDB9LCAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnorroqo3nlLvpnaLjgafjgIHjgIzmrKHjgbjjgI3jg5zjgr/jg7Pjgq/jg6rjg4Pjgq/mmYLjga7jgqTjg5njg7Pjg4hcbiAgICogQHJldHVybiB7Ym9vbGVhbn0g5bi444GrZmFsc2VcbiAgICovXG4gIGZ1bmN0aW9uIG9uQ2xpY2tDb25maXJtTmV4dCgpIHtcbiAgICBpZiAoIWdyZWNhcHRjaGFNb2RlbC5jb3JyZWN0ZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgdXNlcktleSA9IGlucHV0LmVtYWlsLnJlcGxhY2UoL1suXS9nLCAnXycpO1xuICAgIHZhciBtID0gbW9tZW50KCk7XG4gICAgdmFyIHJpZ2h0Tm93ID0gbS5mb3JtYXQoJ1lZWVktTU0tREQtSEgtbW0tc3MnKTtcblxuICAgIHZhciBkYiA9IGZpcmViYXNlLmRhdGFiYXNlKCk7XG4gICAgdmFyIGNvbnRhY3QgPSBkYi5yZWYoJy9jb250YWN0LycgKyB1c2VyS2V5ICsgJy8nICsgcmlnaHROb3cpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnRhY3Quc2V0KGlucHV0KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuXG4gICAgZ2FTZW5kRXZlbnQoJ3RoYW5rcycpO1xuICAgIHB1c2hTdGF0ZUJ5Q29udGFpbmVyKCcudGhhbmtzX2NvbnRhaW5lcicpO1xuICAgIGFjdGl2ZUNvbnRhaW5lcignLnRoYW5rc19jb250YWluZXInKTtcblxuICAgICQoJ2JvZHksaHRtbCcpLmFuaW1hdGUoe3Njcm9sbFRvcDogMH0sIDApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVUkzjgYzlpInjgo/jgaPjgZ/jgajjgY3jga7jgqTjg5njg7Pjg4hcbiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnRJZ25vcmVkIOOCpOODmeODs+ODiFxuICAgKi9cbiAgZnVuY3Rpb24gb25Qb3BTdGF0ZShldmVudElnbm9yZWQpIHtcbiAgICAvKlxuICAgIGlmICghZXZlbnQub3JpZ2luYWxFdmVudC5zdGF0ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAqL1xuICAgIHZhciBoYXNoID0gbG9jYXRpb24uaGFzaDtcbiAgICB2YXIgY29udGFpbmVySWQgPSAnJztcbiAgICAkLmVhY2goY29udGFpbmVycywgZnVuY3Rpb24oaSwgY29udGFpbmVyKSB7XG4gICAgICBpZiAoY29udGFpbmVyLnVybCA9PT0gaGFzaCkge1xuICAgICAgICBjb250YWluZXJJZCA9IGNvbnRhaW5lci5pZDtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBjb250YWluZXIgPSBnZXRDb250YWluZXIoY29udGFpbmVySWQpO1xuICAgIGFjdGl2ZUNvbnRhaW5lcihjb250YWluZXIuaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdB44Gr44Kk44OZ44Oz44OI6KiY6Yyy44CCXG4gICAqIOOBiuWVj+OBhOWQiOOCj+OBm+OBruS+nemgvOOCv+OCpOODl+OBqOOBqOOCguOBq+mAgeS/oeOBmeOCi+OAglxuICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudEFjdGlvbiDjgqTjg5njg7Pjg4hcbiAgICovXG4gIGZ1bmN0aW9uIGdhU2VuZEV2ZW50KGV2ZW50QWN0aW9uKSB7XG4gICAgdmFyIHR5cGUgPSAkKCdpbnB1dFtuYW1lPVwidHlwZVwiXTpjaGVja2VkJykudmFsKCk7XG4gICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnQ29udGFjdCcsIGV2ZW50QWN0aW9uLCB0eXBlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjb250YWluZXJJZCDjgacgcHVzaFN0YXRlIOOBmeOCi+ODpuODvOODhuOCo+ODquODhuOCoy5cbiAgICogY29udGFpbmVycyDphY3liJfjgpIgY29udGFpbmVySWQg44Gn5qSc57Si44GX44Gm44CBXG4gICAqIGNvbnRhaW5lciDjga4gVVJMIOOBpyBwdXNoU3RhdGUg44GZ44KLXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250YWluZXJJZCDjgrPjg7Pjg4bjg4pJRFxuICAgKi9cbiAgZnVuY3Rpb24gcHVzaFN0YXRlQnlDb250YWluZXIoY29udGFpbmVySWQpIHtcbiAgICB2YXIgY29udGFpbmVyID0gZ2V0Q29udGFpbmVyKGNvbnRhaW5lcklkKTtcbiAgICBoaXN0b3J5LnB1c2hTdGF0ZSh0cnVlLCBjb250YWluZXIudGl0bGUsIGJhc2VIcmVmICsgY29udGFpbmVyLnVybCk7XG4gIH1cblxuICAvKipcbiAgICogY29udGFpbmVySWQg44GnIHNob3cvaGlkZSDjgZnjgovjg6bjg7zjg4bjgqPjg6rjg4bjgqMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250YWluZXJJZCDjgrPjg7Pjg4bjg4pJRFxuICAgKi9cbiAgZnVuY3Rpb24gYWN0aXZlQ29udGFpbmVyKGNvbnRhaW5lcklkKSB7XG4gICAgaWYgKGNvbnRhaW5lcklkID09PSAnJykge1xuICAgICAgY29udGFpbmVySWQgPSAnLmlucHV0X2NvbnRhaW5lcic7XG4gICAgfVxuICAgIHZhciB0aGF0ID0gZ2V0Q29udGFpbmVyKGNvbnRhaW5lcklkKTtcbiAgICAkLmVhY2goY29udGFpbmVycywgZnVuY3Rpb24oaSwgY29udGFpbmVyKSB7XG4gICAgICBpZiAoY29udGFpbmVyLmlkID09PSB0aGF0LmlkKSB7XG4gICAgICAgICQoY29udGFpbmVyLmlkKS5zaG93KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKGNvbnRhaW5lci5pZCkuaGlkZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICh0aGF0LmluaXRGdW5jICE9PSBudWxsKSB7XG4gICAgICB0aGF0LmluaXRGdW5jKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNvbnRhaW5lcklkIOOBpyBjb250YWluZXJzIOOCkuaOouOBmVxuICAgKiBAcGFyYW0ge3N0cmluZ30gY29udGFpbmVySWQg44Kz44Oz44OG44OKSURcbiAgICogQHJldHVybiB7Rm9ybUNvbnRhaW5lcn0g44Kz44Oz44OG44OKXG4gICAqL1xuICBmdW5jdGlvbiBnZXRDb250YWluZXIoY29udGFpbmVySWQpIHtcbiAgICB2YXIgdGhhdCA9IG51bGw7XG4gICAgJC5lYWNoKGNvbnRhaW5lcnMsIGZ1bmN0aW9uKGksIGNvbnRhaW5lcikge1xuICAgICAgaWYgKGNvbnRhaW5lci5pZCA9PT0gY29udGFpbmVySWQpIHtcbiAgICAgICAgdGhhdCA9IGNvbnRhaW5lcjtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmICh0aGF0ID09PSBudWxsKSB7XG4gICAgICB0aGF0ID0gY29udGFpbmVyc1swXTtcbiAgICB9XG4gICAgcmV0dXJuIHRoYXQ7XG4gIH1cblxuICAvKipcbiAgICog5pS56KGM44KSPGJyPuOBq+WkieaPm+OBl+OBpuihqOekuuOBmeOCi1xuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIOWkieaPm+WJjVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IOWkieaPm+W+jFxuICAgKi9cbiAgZnVuY3Rpb24gc2FmZU5sMmJyKHN0cikge1xuICAgIHZhciAkc2FmZVRleHQgPSAkKCc8cD48L3A+Jyk7XG4gICAgJHNhZmVUZXh0LnRleHQoc3RyKTtcbiAgICB2YXIgaHRtbCA9ICRzYWZlVGV4dC5odG1sKCk7XG4gICAgcmV0dXJuIGh0bWwucmVwbGFjZSgvXFxyXFxuL2csICc8YnIgLz4nKS5yZXBsYWNlKC9bXFxyXFxuXS9nLCAnPGJyIC8+Jyk7XG4gIH1cblxuICAvKipcbiAgICog44Kt44Oj44OX44OB44Oj44GMT0vjgavjgarjgaPjgZ/jgajjgY3jga7jgqTjg5njg7Pjg4jjgpLkuIrmm7jjgY3oqK3lrprjgZnjgotcbiAgICovXG4gIGdyZWNhcHRjaGFNb2RlbC5vbkNvcnJlY3RDYXB0Y2hhID0gZnVuY3Rpb24oKSB7XG4gICAgJGNvbmZpcm1CdXR0b24ucHJvcCgnZGlzYWJsZWQnLCAhZ3JlY2FwdGNoYU1vZGVsLmNvcnJlY3RlZCk7XG4gIH07XG5cbiAgc3RhcnQoKTtcbn0pO1xuIl0sImZpbGUiOiJhNWNvbnRhY3QuanMifQ==\n"]}